This repository contains the cray-nexus helm chart. The chart creates the sonatype nexus pod and sets the pod up for use.


## Image Upgrade Procedure

To update the image version that nexus uses a new version must be made in the (container images repo)[https://github.com/Cray-HPE/container-images/tree/main/docker.io/sonatype/nexus3]. To make a new version everything from the latest previous version (3.38.0 - 04/2022) should be copied over to the new version. To create a new version there is a script that can be run from the container-images repository. This will set up the folder and docker file, to ensure nexus is created correctly there is two files that must be brought into the new folder for the new version. The create-trust-store.sh and nexus3-keycloak-plugin-0.5.0-bundle.kar. Then the docker file must be edited to reflect how it is created in the latest previous version (3.38.0 - 04/2022). Once the files have been created and edited a pull request should be made to push the new folder and workflow to main. The pull request will run the workflow and tests then upload the container image to (artifactory)[https://artifactory.algol60.net/ui/repos/tree/General/csm-docker%2Fstable%2Fdocker.io%2Fsonatype%2Fnexus3] to be used in the cray-nexus chart.

After the new image version is created in this repository the chart needs to be updated. To update the chart to use the latest version there is two lines that reference the image pulled for nexus. In (values.yaml)[https://github.com/Cray-HPE/cray-nexus/blob/master/kubernetes/cray-nexus/values.yaml] both line 42 (sonatype-nexus.nexus.imageTag) and line 88 (sonatype-nexus.deployment.initContainers.image) refence the image version to be pulled and should be updated for the new version. To edit the chart to pull requests must be made. The first pull request should only update the chart while leaving the chart version the same. The second pull request should update the chart version while leaving everything else. Then a github release should be made from the version change commit. This will then build and upload the chart to (artifactory)[https://artifactory.algol60.net/ui/repos/tree/General/csm-helm-charts%2Fstable%2Fcray-nexus] which can be pulled by helm.